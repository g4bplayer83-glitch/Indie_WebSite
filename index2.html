<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Indie_WebsiteV2</title>
  <link rel="icon" type="image/x-icon" href="icon.ico">
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #0b0b0b;
      color: #00ffff;
      font-family: Arial, sans-serif;
      overflow-x: hidden;
      text-align: center;
      scroll-behavior: smooth;
    }

    h1, h2, h3 {
      text-shadow: 0 0 20px #00ffff;
    }

    /* Style pour le titre avec effet d√©crypt√© */ 
    #mainTitle {
      cursor: pointer;
      transition: all 0.3s;
      text-shadow: 0 0 15px #00ffff, 0 0 30px #00ffff;
    }

    #mainTitle:hover {
      transform: scale(1.05);
    }

    /* Conteneur pour le texte anim√© */
    .moving-text-container {
      width: 100%;
      overflow: hidden;
      position: relative;
      height: 40px;
      display: flex;
      align-items: center;
    }

    /* Texte anim√© - appara√Æt √† droite, sort √† gauche */
    .moving-text {
      display: inline-block;
      white-space: nowrap;
      position: absolute;
      animation: scrollText 15s linear infinite;
    }

    @keyframes scrollText {
      0% { 
        left: 100%;
      }
      100% { 
        left: -100%;
      }
    }

    p {
      color: #ccfaff;
      line-height: 1.6em;
      max-width: 800px;
      margin: 10px auto;
    }

    a {
      color: #00ffff;
      text-decoration: none;
      border-bottom: 1px dotted #00ffff;
      transition: 0.3s;
      cursor: pointer;
    }

    a:hover {
      color: #000;
      background: #00ffff;
      padding: 2px 6px;
      border-radius: 6px;
    }

    /* √âcran de d√©marrage */
    #startScreen {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle, #001f2f, #000);
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      z-index: 20;
      animation: fadeIn 1s ease;
    }

    #skipButton {
      position: absolute;
      bottom: 20px;
      right: 20px;
      padding: 8px 16px;
      background: rgba(0, 255, 255, 0.2);
      border: 1px solid #00ffff;
      color: #00ffff;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9em;
    }

    #skipButton:hover {
      background: rgba(0, 255, 255, 0.4);
      box-shadow: 0 0 10px #00ffff;
    }

    /* √âcran de chargement */
    #loading {
      position: fixed;
      inset: 0;
      background: radial-gradient(circle, #002f3f, #000);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      opacity: 0;
      visibility: hidden;
      z-index: 10;
      transition: opacity 0.8s ease;
    }

    #loading.active {
      opacity: 0;
      visibility: visible;
    }

    .orb {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: #00ffff;
      box-shadow: 0 0 25px #00ffff;
      animation: spinPulse 2s infinite ease-in-out;
    }

    @keyframes spinPulse {
      0% { transform: scale(1) rotate(0deg); opacity: 0.8; }
      50% { transform: scale(1.3) rotate(180deg); opacity: 1; }
      100% { transform: scale(1) rotate(360deg); opacity: 0.8; }
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes fadeOut { to { opacity: 0; visibility: hidden; } }
    @keyframes fadeInMain { to { opacity: 1; } }

    main {
      opacity: 0;
      animation: fadeInMain 1s ease 9s forwards;
      padding: 30px;
      padding-bottom: 120px;
    }

    /* Contr√¥leur audio */
    #soundController {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 20, 25, 0.8);
      border: 2px solid #00ffff;
      border-radius: 12px;
      box-shadow: 0 0 15px #00ffff;
      padding: 12px 16px;
      color: #00ffff;
      font-size: 0.9em;
      z-index: 5;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    #soundController input[type=range] {
      width: 100px;
      accent-color: #00ffff;
    }

    img {
      border: 2px solid #00ffff;
      border-radius: 10px;
      margin: 15px;
      width: 300px;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    img:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px #00ffff;
    }

    note {
      display: block;
      background: rgba(0, 255, 255, 0.1);
      border-left: 4px solid #00ffff;
      margin: 20px auto;
      max-width: 600px;
      padding: 10px 15px;
      font-style: italic;
      color: #aef6f6;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }
    
    #tetrisButton {
      color: #00ffff;
      cursor: pointer;
      transition: all 0.2s;
      text-shadow: 0 0 5px #00ffff;
      font-weight: bold;
      font-style: normal;
    }
    
    #tetrisButton:hover {
      color: #fff;
      text-shadow: 0 0 15px #00ffff, 0 0 25px #00ffff;
      transform: scale(1.2);
      display: inline-block;
    }

    /* Modal Tetris */
    #tetrisModal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      z-index: 100;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    #tetrisModal.active {
      display: flex;
    }

    #tetrisContainer {
      position: relative;
      background: rgba(0, 20, 25, 0.9);
      border: 3px solid #00ffff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 0 40px #00ffff;
      display: flex;
      gap: 20px;
    }

    #closeButton {
      position: absolute;
      top: 10px;
      right: 10px;
      background: transparent;
      border: 2px solid #00ffff;
      color: #00ffff;
      width: 35px;
      height: 35px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.2em;
      transition: all 0.3s;
    }

    #closeButton:hover {
      background: #00ffff;
      color: #000;
      transform: rotate(90deg);
    }

    #tetrisCanvas {
      border: 2px solid #00ffff;
      background: #000;
      display: block;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.3);
    }

    #nextPieceCanvas {
      border: 2px solid #00ffff;
      background: #000;
      display: block;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);
    }

    #tetrisInfo {
      color: #00ffff;
      text-align: center;
      margin-top: 15px;
      font-size: 1.1em;
    }

    #tetrisScore {
      margin-top: 10px;
      font-size: 1.3em;
      text-shadow: 0 0 10px #00ffff;
    }

    .tetris-sidebar {
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .paragraphe-style {
      text-align: justify;
      text-justify: inter-word;
      line-height: 1.6;
      margin: 15px 0;
      padding: 10px;
      background-color: #4a41878b;
      border-left: 25px solid #527d99;
      box-shadow: 0 0 10px rgba(0, 255, 255, 0.2);
    }

    /* Footer avec note */
    .footer-note {
      background: rgba(0, 255, 255, 0.1);
      border: 1px solid #00ffff;
      border-radius: 12px;
      padding: 15px;
      margin: 30px auto;
      max-width: 800px;
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    }

    /* Animation de particules pour Tetris */
    .tetris-particle {
      position: absolute;
      width: 4px;
      height: 4px;
      background: #00ffff;
      border-radius: 50%;
      pointer-events: none;
      opacity: 0.8;
    }

    @keyframes particle-fall {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(50px) scale(0);
        opacity: 0;
      }
    }

    /* Animation de chute rapide */
    @keyframes hard-drop {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 0.5;
      }
      100% {
        opacity: 1;
      }
    }

    .hard-drop-animation {
      animation: hard-drop 0.3s ease;
    }
  </style>
</head>

<body>

  <!-- √âcran de d√©marrage -->
  <div id="startScreen">
    <h1>Indie_WebsiteV2</h1>
    <p style="color:#00ffff;margin-bottom:20px;">Chargement en cours...</p>
    <button id="skipButton">‚è© Passer</button>
  </div>

  <!-- √âcran de chargement -->
  <div id="loading">
    <div class="orb"></div>
    <p style="color:#00ffff;margin-top:20px;font-size:1.2em;">Chargement...</p>
  </div>

  <!-- Musiques -->
  <audio id="introMusic" src="intro.wav"></audio>
  <audio id="bgMusic" src="music.wav" loop></audio>

  <!-- Effets -->
  <audio id="hoverSound" src="hover.wav"></audio>
  <audio id="clickSound" src="click.wav"></audio>

  <!-- Contenu principal -->
  <main>
    <h1 id="mainTitle">Bienvenue sur Indie_WebsiteV2</h1>
    <div class="moving-text-container">
      <h2 class="moving-text">Projet exp√©rimental ‚Äì Page HTML interactive</h2>
    </div>

    <p>
      Ce site explore les sons, les effets visuels et les animations synchronis√©es en HTML, CSS.
      Il offre une exp√©rience immersive avec musique, vid√©o et interactions.
    </p>

    <note>üí° Astuce : quand vous lisez la vid√©o, la musique se coupe avec un fondu automatiquement, puis reprend ensuite.</note>

    <h3>Vid√©o en vedette</h3>
    <video id="myVideo" width="480" height="270" controls>
      <source src="ULTRAKILL Montage - TEOAT.mp4" type="video/mp4">
      Votre navigateur ne supporte pas la vid√©o.
    </video>

    <h3>Quelques liens utiles</h3>
    <p>
      üîó <a id="scrollToImages" title="Descendre √† la section des images">Voir les images plus bas</a><br>
      üåê <a href="https://www.mozilla.org" target="_blank" title="Visitez Mozilla dans une nouvelle fen√™tre">Visitez Mozilla</a>
    </p>

    <h1 style="color: #e60012; margin-bottom: 10px; text-shadow: 0 0 10px rgba(230, 0, 18, 0.7);">L'histoire de la console " WII U "</h1>
    
    <p class="paragraphe-style">
      Lanc√©e en 2012, la Wii U repr√©sentait la tentative ambitieuse de Nintendo de r√©concilier deux publics distincts : les joueurs occasionnels qui avaient ador√© la Wii et les joueurs plus hardcore qui s'en √©taient d√©tourn√©s. Le concept central reposait sur le GamePad, une manette innovante int√©grant un √©cran tactile, permettant des exp√©riences de jeu asym√©triques et le jeu sans t√©l√©vision.
    </p>

    <p class="paragraphe-style">
      Malheureusement, la console a souffert d'un probl√®me de communication majeur d√®s son annonce. Le nom "Wii U" et le design du GamePad ont cr√©√© une confusion g√©n√©ralis√©e, beaucoup croyant qu'il s'agissait d'un simple accessoire pour la Wii originale. Cette ambigu√Øt√© initiale a entrav√© sa compr√©hension par le grand public et a constitu√© un handicap majeur pour son adoption.
    </p>

    <p class="paragraphe-style">
      Malgr√© une puissance sup√©rieure √† sa g√©n√©ration pr√©c√©dente, la Wii U s'est retrouv√©e techniquement d√©pass√©e par l'arriv√©e des PlayStation 4 et Xbox One. Elle a √©galement subi de longs d√©lais sans sorties majeures, les √©diteurs tiers lui accordant un support limit√©. La console a ainsi surv√©cu principalement gr√¢ce √† ses titres internes, comme "Mario Kart 8", "Super Smash Bros." et la nouvelle franchise "Splatoon".
    </p>

    <p class="paragraphe-style">
      Commercialement, la Wii U est consid√©r√©e comme un √©chec pour Nintendo, avec seulement environ 13,5 millions d'unit√©s vendues. Cependant, son h√©ritage est immense. Elle a servi de banc d'essai pour des concepts qui ont √©t√© perfectionn√©s avec la Nintendo Switch. Des jeux comme "Breath of the Wild" et les m√©caniques de jeu hybrides ont √©t√© directement influenc√©s par les innovations, malheureusement sous-exploit√©es, de la Wii U.
    </p>

    <p class="paragraphe-style conclusion">
      En d√©finitive, la Wii U reste une console tragiquement en avance sur son temps. Son √©chec a fourni √† Nintendo des le√ßons cruciales qui ont conduit au succ√®s plan√©taire de la Switch, faisant d'elle une pi√®ce ma√Ætresse, bien que m√©connue, de l'histoire du jeu vid√©o.
    </p>

    <h3 id="images-section">Galerie d'images</h3>
    <p>Survolez les images pour voir un effet lumineux :</p>

    <img src="https://upload.wikimedia.org/wikipedia/commons/3/3a/Cat03.jpg" alt="Un chat mignon" title="Ceci est un chat üê±">
    <img src="https://upload.wikimedia.org/wikipedia/commons/a/a9/Example.jpg" alt="Exemple d'image" title="Image d'exemple">

    <note>üìù Remarque : ce site est encore en d√©veloppement. Cer<span id="tetrisButton" title="Jouer √† Tetris">t</span>aines fonctions peuvent √©voluer.</note>

    <!-- Footer avec note -->
    <div class="footer-note">
      <h3>Notes du d√©veloppeur</h3>
      <p>N'h√©sitez pas √† explorer toutes les fonctionnalit√©s cach√©es !</p>
    </div>
  </main>

  <!-- Modal Tetris -->
  <div id="tetrisModal">
    <div id="tetrisContainer">
      <button id="closeButton">√ó</button>
      <div>
        <canvas id="tetrisCanvas" width="200" height="360"></canvas>
        <div id="tetrisInfo">
          <div>Fl√®ches : D√©placer | ‚Üë : Rotation | Espace : Chute rapide</div>
          <div id="tetrisScore">Score: 0</div>
        </div>
      </div>
      <div class="tetris-sidebar">
        <div>
          <h4 style="margin: 0 0 10px 0; text-shadow: 0 0 5px #00ffff;">Prochain:</h4>
          <canvas id="nextPieceCanvas" width="80" height="80"></canvas>
        </div>
        <div>
          <h4 style="margin: 10px 0; text-shadow: 0 0 5px #00ffff;">Contr√¥les:</h4>
          <p style="font-size: 0.8em; text-align: left; margin: 5px 0;">
            ‚Üê ‚Üí : D√©placer<br>
            ‚Üë : Tourner<br>
            ‚Üì : Descendre<br>
            Espace : Poser
          </p>
        </div>
      </div>
    </div>
  </div>

  <!-- Contr√¥leur audio -->
  <div id="soundController">
    <button id="toggleMusic">‚è∏ Pause musique</button>
    <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="0.5">
    <div id="clock">--:--:--</div>
  </div>

  <script>
    // ===== INITIALISATION =====
    const startScreen = document.getElementById("startScreen");
    const loading = document.getElementById("loading");
    const skipButton = document.getElementById("skipButton");
    const introMusic = document.getElementById("introMusic");
    const bgMusic = document.getElementById("bgMusic");
    const hoverSound = document.getElementById("hoverSound");
    const clickSound = document.getElementById("clickSound");
    const vid = document.getElementById("myVideo");
    const toggleMusic = document.getElementById("toggleMusic");
    const volumeSlider = document.getElementById("volumeSlider");
    const clock = document.getElementById("clock");
    let isFading = false;

    // D√©marrage automatique
    window.addEventListener('load', () => {
      loading.classList.add("active");
      introMusic.volume = 0.6;
      bgMusic.volume = 0.5;
      introMusic.play();
      
      setTimeout(() => {
        introMusic.pause();
        loading.classList.remove("active");
        startScreen.style.animation = "fadeOut 0.8s forwards";
        setTimeout(() => {
          bgMusic.play();
        }, 500);
      }, 8000);
    });

    // Bouton skip
    skipButton.addEventListener("click", () => {
      playClick();
      fadeOutAudio(introMusic, 300);
      startScreen.style.animation = "fadeOut 0.8s forwards";
      setTimeout(() => {
        loading.classList.remove("active");
        bgMusic.play();
      }, 500);
    });

    // Fade musique
    function fadeOutAudio(audio, duration = 500) {
      if (isFading) return;
      isFading = true;
      const step = audio.volume / (duration / 50);
      const fade = setInterval(() => {
        if (audio.volume > 0.05) audio.volume -= step;
        else {
          audio.volume = 0;
          audio.pause();
          clearInterval(fade);
          isFading = false;
        }
      }, 50);
    }

    function fadeInAudio(audio, targetVol = 0.5, duration = 1000) {
      if (isFading) return;
      isFading = true;
      audio.play();
      let vol = 0;
      audio.volume = 0;
      const step = targetVol / (duration / 50);
      const fade = setInterval(() => {
        if (vol < targetVol) {
          vol += step;
          audio.volume = vol;
        } else {
          audio.volume = targetVol;
          clearInterval(fade);
          isFading = false;
        }
      }, 50);
    }

    vid.addEventListener("play", () => fadeOutAudio(bgMusic, 1200));
    vid.addEventListener("pause", () => fadeInAudio(bgMusic, parseFloat(volumeSlider.value), 1200));
    vid.addEventListener("ended", () => fadeInAudio(bgMusic, parseFloat(volumeSlider.value), 1200));

    // Liens interactifs
    document.getElementById("scrollToImages").addEventListener("click", () => {
      document.getElementById("images-section").scrollIntoView({ behavior: "smooth" });
      playClick();
    });

    document.querySelectorAll("button").forEach(btn => {
      btn.addEventListener("mouseenter", () => {
        hoverSound.currentTime = 0;
        hoverSound.play();
      });
    });

    function playClick() {
      clickSound.currentTime = 0;
      clickSound.play();
    }

    // Musique / volume
    toggleMusic.addEventListener("click", () => {
      if (bgMusic.paused) {
        fadeInAudio(bgMusic, parseFloat(volumeSlider.value), 800);
        toggleMusic.textContent = "‚è∏ Pause musique";
      } else {
        fadeOutAudio(bgMusic, 800);
        toggleMusic.textContent = "‚ñ∂ Reprendre musique";
      }
      playClick();
    });

    volumeSlider.addEventListener("input", () => {
      const vol = parseFloat(volumeSlider.value);
      bgMusic.volume = vol;
      introMusic.volume = vol;
    });

    // Horloge
    setInterval(() => clock.textContent = new Date().toLocaleTimeString(), 1000);

    // ===== TETRIS AM√âLIOR√â =====
    const tetrisButton = document.getElementById("tetrisButton");
    const tetrisModal = document.getElementById("tetrisModal");
    const closeButton = document.getElementById("closeButton");
    const canvas = document.getElementById("tetrisCanvas");
    const nextPieceCanvas = document.getElementById("nextPieceCanvas");
    const ctx = canvas.getContext("2d");
    const nextCtx = nextPieceCanvas.getContext("2d");
    const scoreDisplay = document.getElementById("tetrisScore");

    const ROWS = 18;
    const COLS = 10;
    const BLOCK_SIZE = 20;
    let board = [];
    let score = 0;
    let gameActive = false;
    let currentPiece = null;
    let nextPiece = null;
    let gameLoop = null;

    const SHAPES = [
      [[1,1,1,1]], // I
      [[1,1],[1,1]], // O
      [[0,1,0],[1,1,1]], // T
      [[1,0,0],[1,1,1]], // L
      [[0,0,1],[1,1,1]], // J
      [[0,1,1],[1,1,0]], // S
      [[1,1,0],[0,1,1]]  // Z
    ];

    const COLORS = ['#00ffff', '#ffff00', '#ff00ff', '#00ff00', '#ff8800', '#ff0000', '#0088ff'];

    function initBoard() {
      board = Array(ROWS).fill().map(() => Array(COLS).fill(0));
      score = 0;
      scoreDisplay.textContent = `Score: ${score}`;
    }

    function drawBoard() {
      ctx.fillStyle = '#000';
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          if (board[r][c]) {
            ctx.fillStyle = COLORS[board[r][c] - 1];
            ctx.fillRect(c * BLOCK_SIZE, r * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
            ctx.strokeStyle = '#00ffff';
            ctx.lineWidth = 1;
            ctx.strokeRect(c * BLOCK_SIZE, r * BLOCK_SIZE, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
          }
        }
      }

      if (currentPiece) {
        ctx.fillStyle = COLORS[currentPiece.color];
        currentPiece.shape.forEach((row, r) => {
          row.forEach((cell, c) => {
            if (cell) {
              const x = (currentPiece.x + c) * BLOCK_SIZE;
              const y = (currentPiece.y + r) * BLOCK_SIZE;
              ctx.fillRect(x, y, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
              ctx.strokeStyle = '#00ffff';
              ctx.strokeRect(x, y, BLOCK_SIZE - 1, BLOCK_SIZE - 1);
            }
          });
        });
      }
    }

    function drawNextPiece() {
      nextCtx.fillStyle = '#000';
      nextCtx.fillRect(0, 0, nextPieceCanvas.width, nextPieceCanvas.height);
      
      if (nextPiece) {
        const offsetX = (nextPieceCanvas.width - nextPiece.shape[0].length * BLOCK_SIZE/2) / 2;
        const offsetY = (nextPieceCanvas.height - nextPiece.shape.length * BLOCK_SIZE/2) / 2;
        
        nextCtx.fillStyle = COLORS[nextPiece.color];
        nextPiece.shape.forEach((row, r) => {
          row.forEach((cell, c) => {
            if (cell) {
              const x = offsetX + c * BLOCK_SIZE/2;
              const y = offsetY + r * BLOCK_SIZE/2;
              nextCtx.fillRect(x, y, BLOCK_SIZE/2 - 1, BLOCK_SIZE/2 - 1);
              nextCtx.strokeStyle = '#00ffff';
              nextCtx.strokeRect(x, y, BLOCK_SIZE/2 - 1, BLOCK_SIZE/2 - 1);
            }
          });
        });
      }
    }

    function createPiece() {
      const shapeIndex = Math.floor(Math.random() * SHAPES.length);
      return {
        shape: SHAPES[shapeIndex],
        color: shapeIndex,
        x: Math.floor(COLS / 2) - 1,
        y: 0
      };
    }

    function collides(piece, offsetX = 0, offsetY = 0) {
      for (let r = 0; r < piece.shape.length; r++) {
        for (let c = 0; c < piece.shape[r].length; c++) {
          if (piece.shape[r][c]) {
            const newX = piece.x + c + offsetX;
            const newY = piece.y + r + offsetY;
            if (newX < 0 || newX >= COLS || newY >= ROWS) return true;
            if (newY >= 0 && board[newY][newX]) return true;
          }
        }
      }
      return false;
    }

    // Fonction pour cr√©er des particules
    function createParticles(x, y, count = 8) {
      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        particle.className = 'tetris-particle';
        particle.style.left = `${x}px`;
        particle.style.top = `${y}px`;
        document.body.appendChild(particle);
        
        const angle = Math.random() * Math.PI * 2;
        const distance = Math.random() * 30 + 10;
        const targetX = x + Math.cos(angle) * distance;
        const targetY = y + Math.sin(angle) * distance;
        
        particle.style.animation = `particle-fall ${Math.random() * 0.5 + 0.3}s ease forwards`;
        particle.style.left = `${targetX}px`;
        
        setTimeout(() => {
          if (particle.parentNode) {
            particle.parentNode.removeChild(particle);
          }
        }, 500);
      }
    }

    function mergePiece() {
      // Cr√©er des particules √† chaque bloc pos√©
      currentPiece.shape.forEach((row, r) => {
        row.forEach((cell, c) => {
          if (cell) {
            const y = currentPiece.y + r;
            const x = currentPiece.x + c;
            if (y >= 0) {
              board[y][x] = currentPiece.color + 1;
              // Cr√©er des particules √† la position du bloc
              const canvasRect = canvas.getBoundingClientRect();
              const particleX = canvasRect.left + x * BLOCK_SIZE + BLOCK_SIZE/2;
              const particleY = canvasRect.top + y * BLOCK_SIZE + BLOCK_SIZE/2;
              createParticles(particleX, particleY, 3);
            }
          }
        });
      });
    }

    function clearLines() {
      let linesCleared = 0;
      for (let r = ROWS - 1; r >= 0; r--) {
        if (board[r].every(cell => cell !== 0)) {
          // Cr√©er plus de particules pour une ligne compl√®te
          for (let c = 0; c < COLS; c++) {
            const canvasRect = canvas.getBoundingClientRect();
            const particleX = canvasRect.left + c * BLOCK_SIZE + BLOCK_SIZE/2;
            const particleY = canvasRect.top + r * BLOCK_SIZE + BLOCK_SIZE/2;
            createParticles(particleX, particleY, 5);
          }
          
          board.splice(r, 1);
          board.unshift(Array(COLS).fill(0));
          linesCleared++;
          r++;
        }
      }
      if (linesCleared > 0) {
        score += linesCleared * 100;
        scoreDisplay.textContent = `Score: ${score}`;
      }
    }

    function rotatePiece() {
      const rotated = currentPiece.shape[0].map((_, i) =>
        currentPiece.shape.map(row => row[i]).reverse()
      );
      const oldShape = currentPiece.shape;
      currentPiece.shape = rotated;
      if (collides(currentPiece)) {
        currentPiece.shape = oldShape;
      }
    }

    function hardDrop() {
      // Animation de flash
      canvas.classList.add('hard-drop-animation');
      setTimeout(() => {
        canvas.classList.remove('hard-drop-animation');
      }, 300);
      
      let dropDistance = 0;
      while (!collides(currentPiece, 0, dropDistance + 1)) {
        dropDistance++;
      }
      
      currentPiece.y += dropDistance;
      mergePiece();
      clearLines();
      currentPiece = nextPiece;
      nextPiece = createPiece();
      drawNextPiece();
      
      if (collides(currentPiece)) {
        gameActive = false;
        clearInterval(gameLoop);
        alert(`Game Over! Score: ${score}`);
        tetrisModal.classList.remove("active");
      }
    }

    function gameStep() {
      if (!collides(currentPiece, 0, 1)) {
        currentPiece.y++;
      } else {
        mergePiece();
        clearLines();
        currentPiece = nextPiece;
        nextPiece = createPiece();
        drawNextPiece();
        if (collides(currentPiece)) {
          gameActive = false;
          clearInterval(gameLoop);
          alert(`Game Over! Score: ${score}`);
          tetrisModal.classList.remove("active");
        }
      }
      drawBoard();
    }

    function startGame() {
      initBoard();
      currentPiece = createPiece();
      nextPiece = createPiece();
      gameActive = true;
      drawBoard();
      drawNextPiece();
      gameLoop = setInterval(gameStep, 500);
    }

    tetrisButton.addEventListener("click", () => {
      playClick();
      tetrisModal.classList.add("active");
      startGame();
    });

    closeButton.addEventListener("click", () => {
      playClick();
      tetrisModal.classList.remove("active");
      gameActive = false;
      if (gameLoop) clearInterval(gameLoop);
    });

    document.addEventListener("keydown", (e) => {
      if (!gameActive) return;
      
      // Emp√™cher le scroll de la page avec les fl√®ches
      if (["ArrowLeft", "ArrowRight", "ArrowDown", "ArrowUp", " "].includes(e.key)) {
        e.preventDefault();
      }
      
      if (e.key === "ArrowLeft" && !collides(currentPiece, -1, 0)) {
        currentPiece.x--;
      } else if (e.key === "ArrowRight" && !collides(currentPiece, 1, 0)) {
        currentPiece.x++;
      } else if (e.key === "ArrowDown" && !collides(currentPiece, 0, 1)) {
        currentPiece.y++;
      } else if (e.key === "ArrowUp") {
        rotatePiece();
      } else if (e.key === " ") {
        hardDrop();
      }
      drawBoard();
    });

    tetrisModal.addEventListener("click", (e) => {
      if (e.target === tetrisModal) {
        tetrisModal.classList.remove("active");
        gameActive = false;
        if (gameLoop) clearInterval(gameLoop);
      }
    });

    // ===== EFFETS VISUELS =====
    
    // Effet de texte d√©crypt√© (version simplifi√©e)
    // 1. Effet de texte d√©crypt√© sur le titre
const titleElement = document.getElementById('mainTitle');
const decryptedTitle = new DecryptedText(titleElement, {
  speed: 30,
  maxIterations: 15
});

// 2. Effet de blur graduel en bas de page
const pageBlur = new GradualBlur({
  position: 'bottom',
  strength: 2
});

// 3. Effet de particules au clic (tu dois aussi avoir la classe ClickSpark d√©finie)
// Si tu as la classe ClickSpark d√©finie, ajoute √ßa :
const bodySparkEffect = new ClickSpark(document.body, {
  sparkColor: '#00ffff',
  sparkSize: 15,
  sparkRadius: 20,
  sparkCount: 12,
  duration: 500,
  easing: 'ease-out',
  extraScale: 1.2
});
    
    // Effet de blur graduel (version simplifi√©e)
    class GradualBlur {
  constructor(options = {}) {
    this.position = options.position || 'bottom';
    this.strength = options.strength || 3;
    this.init();
  }
      
      init() {
        // Cr√©ation d'un √©l√©ment de superposition avec d√©grad√©
        const overlay = document.createElement('div');
        overlay.style.position = 'fixed';
        overlay.style.left = '0';
        overlay.style.right = '0';
        overlay.style.height = '100px';
        overlay.style.pointerEvents = 'none';
        overlay.style.zIndex = '999';
        
        if (this.position === 'bottom') {
          overlay.style.bottom = '0';
          overlay.style.background = 'linear-gradient(to top, rgba(11,11,11,0.8), transparent)';
        } else {
          overlay.style.top = '0';
          overlay.style.background = 'linear-gradient(to bottom, rgba(11,11,11,0.8), transparent)';
        }
        
        document.body.appendChild(overlay);
      }
    }
    
    // Initialisation des effets
    document.addEventListener('DOMContentLoaded', () => {
      // Effet de texte d√©crypt√© sur le titre principal
      new DecryptedText(document.getElementById('mainTitle'), {
        speed: 30,
        maxIterations: 15
      });
      
      // Effet de blur graduel en bas de page
      new GradualBlur({
        position: 'bottom',
        strength: 2
      });
    });
  </script>
</body>
</html>
